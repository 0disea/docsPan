---
title: "Error Handling"
description: "Best practices for handling errors in Pan API"
---

Robust error handling is essential for building reliable applications. This guide covers how to handle errors from the Pan API effectively.

## Error response format

All error responses follow a consistent structure:

<ResponseExample>
```json Error response
{
  "error": "ERROR_CODE",
  "message": "Human-readable error message"
}
```
</ResponseExample>

Some errors include additional fields:

<ResponseExample>
```json Error with details
{
  "error": "WALLET_LIMIT_EXCEEDED",
  "message": "You have reached your wallet limit of 100. Upgrade your plan to create more wallets.",
  "currentUsage": 100,
  "limit": 100
}
```
</ResponseExample>

## HTTP status codes

Pan uses standard HTTP status codes:

<CardGroup cols={3}>
  <Card title="400 Bad Request" icon="exclamation-triangle">
    Invalid request format or missing required fields
    
    **Common causes**:
    - Missing required parameters
    - Invalid parameter format
    - Validation errors
  </Card>
  <Card title="401 Unauthorized" icon="lock">
    Authentication failed
    
    **Common causes**:
    - Missing API key
    - Invalid API key
    - Expired API key
  </Card>
  <Card title="403 Forbidden" icon="ban">
    Action not allowed
    
    **Common causes**:
    - Wallet limit exceeded
    - Account suspended
  </Card>
  <Card title="404 Not Found" icon="magnifying-glass">
    Resource doesn't exist
    
    **Common causes**:
    - Invalid wallet ID
    - Invalid intent ID
    - Resource doesn't belong to your account
  </Card>
  <Card title="429 Too Many Requests" icon="clock">
    Rate limit exceeded
    
    **Solution**: Wait before retrying or upgrade your plan
  </Card>
  <Card title="500 Internal Server Error" icon="server">
    Server error
    
    **Solution**: Retry with exponential backoff or contact support
  </Card>
</CardGroup>

## Common error codes

<AccordionGroup>
  <Accordion title="UNAUTHORIZED">
    **Status**: 401
    
    Invalid or missing API key. Check that you're including the API key in the `Authorization` header with the correct format.
    
    ```javascript
    if (error.error === 'UNAUTHORIZED') {
      // Check API key configuration
      console.error('Authentication failed - check API key');
    }
    ```
  </Accordion>
  
  <Accordion title="NOT_FOUND">
    **Status**: 404
    
    The requested resource doesn't exist or doesn't belong to your account.
    
    ```javascript
    if (error.error === 'NOT_FOUND') {
      // Resource doesn't exist or you don't have access
      console.error('Resource not found:', error.message);
    }
    ```
  </Accordion>
  
  <Accordion title="VALIDATION_ERROR">
    **Status**: 400
    
    Request validation failed. Check that all required fields are present and properly formatted.
    
    ```javascript
    if (error.error === 'VALIDATION_ERROR') {
      // Show validation error to user
      showError(error.message);
    }
    ```
  </Accordion>
  
  <Accordion title="WALLET_LIMIT_EXCEEDED">
    **Status**: 403
    
    You've reached your wallet limit. Upgrade your plan or contact support.
    
    ```javascript
    if (error.error === 'WALLET_LIMIT_EXCEEDED') {
      const { currentUsage, limit } = error;
      showUpgradePrompt(`You've reached your limit of ${limit} wallets.`);
    }
    ```
  </Accordion>
  
  <Accordion title="UNSUPPORTED_ACTION">
    **Status**: 400
    
    The requested action isn't supported in the current API version.
    
    ```javascript
    if (error.error === 'UNSUPPORTED_ACTION') {
      showError('This action is not yet available. Check our roadmap for updates.');
    }
    ```
  </Accordion>
  
  <Accordion title="INSUFFICIENT_FUNDS">
    **Status**: 400 (in intent errors)
    
    The wallet doesn't have sufficient funds to complete the intent.
    
    ```javascript
    if (intent.status === 'failed' && intent.error?.code === 'INSUFFICIENT_FUNDS') {
      const { required, available } = intent.error.details;
      showError(`Insufficient funds. Required: ${required}, Available: ${available}`);
    }
    ```
  </Accordion>
</AccordionGroup>

## Error handling patterns

### Basic error handler

<CodeGroup>
```javascript JavaScript
async function handleApiRequest(requestFn) {
  try {
    const response = await requestFn();
    
    if (!response.ok) {
      const error = await response.json();
      throw new ApiError(error.error, error.message, response.status, error);
    }
    
    return await response.json();
  } catch (error) {
    if (error instanceof ApiError) {
      throw error;
    }
    
    // Network or other errors
    throw new Error(`Request failed: ${error.message}`);
  }
}

class ApiError extends Error {
  constructor(code, message, status, details) {
    super(message);
    this.code = code;
    this.status = status;
    this.details = details;
  }
}
```
</CodeGroup>

### Retry with exponential backoff

<CodeGroup>
```javascript JavaScript
async function requestWithRetry(url, options, maxRetries = 3) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      const response = await fetch(url, options);
      
      // Don't retry client errors (4xx) except 429
      if (response.status >= 400 && response.status < 500 && response.status !== 429) {
        const error = await response.json();
        throw new ApiError(error.error, error.message, response.status, error);
      }
      
      // Retry on server errors (5xx) and rate limits (429)
      if (response.status >= 500 || response.status === 429) {
        if (attempt < maxRetries - 1) {
          const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
          const retryAfter = response.headers.get('Retry-After');
          const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : delay;
          
          await new Promise(resolve => setTimeout(resolve, waitTime));
          continue;
        }
      }
      
      if (!response.ok) {
        const error = await response.json();
        throw new ApiError(error.error, error.message, response.status, error);
      }
      
      return await response.json();
    } catch (error) {
      if (attempt === maxRetries - 1) {
        throw error;
      }
      
      // Wait before retry
      const delay = Math.pow(2, attempt) * 1000;
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```
</CodeGroup>

## User-friendly error messages

Transform technical errors into user-friendly messages:

<CodeGroup>
```javascript JavaScript
function getUserFriendlyMessage(error) {
  const errorMessages = {
    'UNAUTHORIZED': 'Authentication failed. Please check your API key.',
    'NOT_FOUND': 'The requested resource was not found.',
    'VALIDATION_ERROR': 'Please check your input and try again.',
    'WALLET_LIMIT_EXCEEDED': 'You\'ve reached your wallet limit. Please upgrade your plan.',
    'INSUFFICIENT_FUNDS': 'Insufficient funds to complete this operation.',
    'UNSUPPORTED_ACTION': 'This feature is not yet available.',
    'INTERNAL_ERROR': 'An unexpected error occurred. Please try again later.'
  };
  
  return errorMessages[error.code] || error.message || 'An error occurred. Please try again.';
}

// Usage
try {
  await createWallet(userId);
} catch (error) {
  const message = getUserFriendlyMessage(error);
  showError(message);
  
  // Log technical details server-side
  console.error('Technical error:', error);
}
```
</CodeGroup>

## Intent error handling

Intents can fail during execution. Handle these errors appropriately:

<CodeGroup>
```javascript JavaScript
function handleIntentError(intent) {
  if (intent.status !== 'failed') {
    return;
  }
  
  const error = intent.error;
  
  switch (error.code) {
    case 'INSUFFICIENT_FUNDS':
      return {
        userMessage: `Insufficient funds. You need ${error.details.required} but only have ${error.details.available}.`,
        canRetry: false,
        action: 'deposit_funds'
      };
      
    case 'TRANSACTION_FAILED':
      return {
        userMessage: 'Transaction failed on blockchain. This may be due to network congestion.',
        canRetry: true,
        action: 'retry_intent'
      };
      
    case 'PROTOCOL_ERROR':
      return {
        userMessage: 'The DeFi protocol returned an error. Please try again later.',
        canRetry: true,
        action: 'retry_intent'
      };
      
    default:
      return {
        userMessage: 'An unexpected error occurred during execution.',
        canRetry: true,
        action: 'contact_support'
      };
  }
}
```
</CodeGroup>

## Best practices

<Tip>
  ✅ **Always check response status**: Don't assume requests succeed
  ✅ **Use specific error codes**: Check error codes for programmatic handling
  ✅ **Provide user-friendly messages**: Transform technical errors for end users
  ✅ **Log technical details**: Keep detailed error logs for debugging
  ✅ **Implement retries**: Retry transient errors (5xx, 429) with backoff
  ✅ **Handle edge cases**: Plan for network failures, timeouts, etc.
</Tip>

<Warning>
  ❌ **Don't retry client errors**: 4xx errors (except 429) shouldn't be retried
  ❌ **Don't expose technical details**: Keep error messages user-friendly
  ❌ **Don't ignore errors**: Always handle errors explicitly
  ❌ **Don't retry indefinitely**: Set maximum retry limits
</Warning>

## Error monitoring

Monitor errors in production:

<CodeGroup>
```javascript JavaScript
async function logError(error, context) {
  // Send to error tracking service (e.g., Sentry, LogRocket)
  await errorTrackingService.captureException(error, {
    tags: {
      error_code: error.code,
      http_status: error.status
    },
    extra: {
      context: context,
      timestamp: new Date().toISOString()
    }
  });
  
  // Also log to your own system
  console.error('API Error:', {
    code: error.code,
    message: error.message,
    status: error.status,
    context: context
  });
}
```
</CodeGroup>

## Related guides

<CardGroup cols={2}>
  <Card
    title="Security"
    icon="shield"
    href="/guides/best-practices/security"
  >
    Secure error handling practices
  </Card>
  <Card
    title="Performance"
    icon="bolt"
    href="/guides/best-practices/performance"
  >
    Optimize error handling for performance
  </Card>
</CardGroup>

