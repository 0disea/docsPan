---
title: "Creating Wallets"
description: "Learn how to create and manage wallets in your application"
---

This guide walks you through creating wallets for users in your application, including best practices and common patterns.

## Basic wallet creation

Creating a wallet is straightforward - you only need a unique user identifier:

<CodeGroup>
```bash cURL
curl -X POST https://api.pan.dev/v1/wallets \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user_123"
  }'
```

```javascript JavaScript
const wallet = await fetch('https://api.pan.dev/v1/wallets', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${process.env.PAN_API_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    userId: 'user_123'
  })
}).then(r => r.json());
```
</CodeGroup>

## Using metadata

You can store additional information with wallets using the `metadata` field:

<CodeGroup>
```bash cURL
curl -X POST https://api.pan.dev/v1/wallets \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user_123",
    "metadata": {
      "email": "user@example.com",
      "name": "John Doe",
      "plan": "premium",
      "region": "us-east"
    }
  }'
```
</CodeGroup>

<Tip>
  **Useful metadata**: Store contextual information like user email, subscription tier, or geographic region. This can help with debugging and analytics later.
</Tip>

## Handling duplicate wallets

Pan prevents duplicate wallets for the same user. If you try to create a wallet with a `userId` that already exists, you'll get an error. Instead, retrieve the existing wallet:

<CodeGroup>
```javascript JavaScript
async function getOrCreateWallet(userId) {
  try {
    // Try to get existing wallet
    const response = await fetch(
      `https://api.pan.dev/v1/wallets/${userId}`,
      {
        headers: {
          'Authorization': `Bearer ${process.env.PAN_API_KEY}`
        }
      }
    );
    
    if (response.ok) {
      return await response.json();
    }
    
    // Wallet doesn't exist, create it
    if (response.status === 404) {
      const createResponse = await fetch('https://api.pan.dev/v1/wallets', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${process.env.PAN_API_KEY}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId })
      });
      
      return await createResponse.json();
    }
    
    throw new Error(`Unexpected error: ${response.statusText}`);
  } catch (error) {
    console.error('Error getting or creating wallet:', error);
    throw error;
  }
}
```
</CodeGroup>

## Wallet limits

Be aware of your subscription plan's wallet limits:

<CardGroup cols={3}>
  <Card title="Free plan" icon="gift">
    **Limit**: 100 wallets
    
    Perfect for testing and small applications
  </Card>
  <Card title="Pro plan" icon="star">
    **Limit**: 10,000 wallets
    
    Suitable for growing applications
  </Card>
  <Card title="Enterprise" icon="crown">
    **Unlimited** wallets
    
    For large-scale applications
  </Card>
</CardGroup>

If you reach your limit, you'll receive a `WALLET_LIMIT_EXCEEDED` error with details about your current usage.

## Best practices

<AccordionGroup>
  <Accordion title="One wallet per user">
    Create one wallet per user in your application and reuse it for all operations. Don't create a new wallet for each transaction or session.
  </Accordion>
  
  <Accordion title="Cache wallet information">
    Wallet addresses and IDs rarely change. Cache this information locally in your application to reduce API calls. Only fetch from the API when necessary.
  </Accordion>
  
  <Accordion title="Handle errors gracefully">
    Always handle errors when creating wallets. Common scenarios include:
    - Network failures
    - Rate limiting
    - Wallet limit exceeded
    - Invalid user IDs
  </Accordion>
  
  <Accordion title="Use meaningful user IDs">
    Use stable, unique identifiers for `userId`. Good examples:
    - Database primary keys: `"12345"`
    - UUIDs: `"550e8400-e29b-41d4-a716-446655440000"`
    - Email addresses: `"user@example.com"`
    
    Avoid temporary or session-based IDs that might change.
  </Accordion>
</AccordionGroup>

## Common patterns

### Lazy wallet creation

Create wallets on-demand when users first need to interact with DeFi:

<CodeGroup>
```javascript JavaScript
async function ensureWalletExists(userId) {
  let wallet = await getWalletByUserId(userId).catch(() => null);
  
  if (!wallet) {
    wallet = await createWallet({ userId });
    console.log(`Created wallet for user ${userId}`);
  }
  
  return wallet;
}

// Use when user wants to check balance or create an intent
const wallet = await ensureWalletExists(user.email);
```
</CodeGroup>

### Batch wallet creation

For migrations or bulk operations, create wallets in batches:

<CodeGroup>
```javascript JavaScript
async function createWalletsForUsers(userIds) {
  const wallets = [];
  const batchSize = 10;
  
  for (let i = 0; i < userIds.length; i += batchSize) {
    const batch = userIds.slice(i, i + batchSize);
    
    const results = await Promise.allSettled(
      batch.map(userId => 
        createWallet({ userId })
          .catch(err => {
            console.error(`Failed to create wallet for ${userId}:`, err);
            return null;
          })
      )
    );
    
    wallets.push(...results.map(r => r.value).filter(Boolean));
    
    // Rate limit: wait 1 second between batches
    if (i + batchSize < userIds.length) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }
  
  return wallets;
}
```
</CodeGroup>

## Related guides

<CardGroup cols={2}>
  <Card
    title="Wallets concept"
    icon="wallet"
    href="/guides/concepts/wallets"
  >
    Deep dive into how wallets work
  </Card>
  <Card
    title="Checking balances"
    icon="chart-line"
    href="/guides/checking-balances"
  >
    Query wallet balances after creation
  </Card>
</CardGroup>

